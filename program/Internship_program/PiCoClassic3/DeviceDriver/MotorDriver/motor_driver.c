/*==============================================================================*/
/* Motor Driver C File								*/
/*==============================================================================*/

/*------------------------------------------------------------------------------*/
/* Include Files								*/
/*------------------------------------------------------------------------------*/
#include "motor_driver.h"

/*------------------------------------------------------------------------------*/
/* Global Variable								*/
/*------------------------------------------------------------------------------*/
unsigned int	step_r;			// 右モーターステップ数(割り込み内でカウントアップ)
unsigned int	step_l;			// 左モーターステップ数(割り込み内でカウントアップ)
float		accel;			// 加速度(設定値→符号なし)
float		r_accel;		// 加速度(実際の値→符号あり)
float		max_speed;		// 最高速度(設定値)
float		min_speed;		// 最低速度(設定値)
float		speed;			// 速度(現在の値)

/*------------------------------------------------------------------------------*/
/* Function prototype								*/
/*------------------------------------------------------------------------------*/
void vd_InitMotor(void);		// モーター制御用パラメータ初期化
void vd_MotorPowerON(void);		// モーター励磁
void vd_MotorPowerOFF(void);		// モーター脱力
void vd_StartMotorControl(void);	// モーター回転開始
void vd_StopMotorControl(void);		// モーター回転停止

/*------------------------------------------------------------------------------*/
/* Function Definitions								*/
/*------------------------------------------------------------------------------*/

/*==============================================================================*/
/* モーター制御用パラメータ初期化			                        */
/* 										*/
/* ---------------------------------------------------------------------------- */
/*  Arguments:		-							*/
/*  Return   :         	-							*/
/*==============================================================================*/
void vd_InitMotor(void)
{
	accel	= 0;
	r_accel = 0;
	speed	= 0;
	max_speed = 0;
	min_speed = 0;
}

/*==============================================================================*/
/* モーター励磁									*/
/* 										*/
/* ステッピングモーターを励磁する						*/
/* ---------------------------------------------------------------------------- */
/*  Arguments:		-							*/
/*  Return   :         	-							*/
/*==============================================================================*/
void vd_MotorPowerON(void)
{
	MOT_POWER_ON;	// ステッピングモータを励磁
}

/*==============================================================================*/
/* モーター脱力									*/
/* 										*/
/* ステッピングモーターを脱力する						*/
/* ---------------------------------------------------------------------------- */
/*  Arguments:		-							*/
/*  Return   :         	-							*/
/*==============================================================================*/
void vd_MotorPowerOFF(void)
{
	MOT_POWER_OFF;	// ステッピングモータを脱力
}

/*==============================================================================*/
/* モーター回転開始			                                        */
/* 										*/
/* ステッピングモーターのPWM制御を開始する					*/
/* ---------------------------------------------------------------------------- */
/*  Arguments:		-							*/
/*  Return   :         	-							*/
/*==============================================================================*/
void vd_StartMotorControl(void)
{
	/* モーターのステップ数のカウントスタート */
	MTU.TSTR.BIT.CST3 = 1;
	MTU.TSTR.BIT.CST4 = 1;	
}

/*==============================================================================*/
/* モーター回転停止			                                        */
/* 										*/
/* ステッピングモーターのPWM制御を停止する					*/
/* ---------------------------------------------------------------------------- */
/*  Arguments:		-							*/
/*  Return   :         	-							*/
/*==============================================================================*/
void vd_StopMotorControl(void)
{
	/* モーターのステップ数のカウントストップ */
	MTU.TSTR.BIT.CST3 = 0;
	MTU.TSTR.BIT.CST4 = 0;
}


